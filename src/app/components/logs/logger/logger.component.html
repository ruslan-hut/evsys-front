@if (!isOnline) {
  <div><mat-progress-bar mode="buffer"></mat-progress-bar></div>
} @else {
  @if (loading) {
    <div>
      <mat-progress-bar mode="indeterminate"></mat-progress-bar>
    </div>
  }
}

<div class="log-container">
  <!-- Filter input -->
  <div class="filter-container">
    <mat-form-field appearance="fill" class="filter-field">
      <mat-label>Filter</mat-label>
      <input matInput placeholder="search..." [(ngModel)]="filter" name="filter" (ngModelChange)="applyFilter($event)"/>
      @if (filter) {
        <button matSuffix mat-icon-button aria-label="Clear" (click)="applyFilter('')">
          <mat-icon>close</mat-icon>
        </button>
      }
    </mat-form-field>
  </div>

  <!-- Mobile Card Layout -->
  @if (isMobile$ | async) {
    <div class="log-cards">
      @for (row of paginatedData; track row.time) {
        <mat-card class="log-card">
          <mat-card-content class="log-card-content">
            <div class="log-card-header">
              <span class="log-time">{{ formatTimeShort(row.time) }}</span>
              <span class="log-date">{{ formatDateShort(row.time) }}</span>
            </div>
            <div class="log-card-meta">
              <span class="log-feature" [class.log-feature-error]="isErrorMessage(row.text)">{{ row.feature }}</span>
              @if (row.id) {
                <span class="log-id">{{ row.id }}</span>
              }
            </div>
            <div class="log-card-text">{{ row.text }}</div>
          </mat-card-content>
        </mat-card>
      } @empty {
        @if (filter) {
          <div class="no-data">No records matching '{{ filter }}'</div>
        } @else {
          <div class="no-data">No log entries</div>
        }
      }
    </div>

    <!-- Mobile Paginator -->
    <mat-paginator
      #logDataPaginator
      [pageSizeOptions]="[10, 25, 50]"
      [showFirstLastButtons]="false"
      aria-label="Select page of log entries">
    </mat-paginator>
  } @else {
    <!-- Desktop Table Layout -->
    <div class="mat-elevation-z8">
      <div class="table-responsive">
        <table mat-table matSort [dataSource]="dataSource">
          <ng-container matColumnDef="time">
            <th mat-header-cell *matHeaderCellDef mat-sort-header>Time</th>
            <td mat-cell *matCellDef="let row">{{ row.time }}</td>
          </ng-container>
          <ng-container matColumnDef="feature">
            <th mat-header-cell *matHeaderCellDef mat-sort-header>Feature</th>
            <td mat-cell *matCellDef="let row">{{ row.feature }}</td>
          </ng-container>
          <ng-container matColumnDef="id">
            <th mat-header-cell *matHeaderCellDef mat-sort-header>Point ID</th>
            <td mat-cell *matCellDef="let row">{{ row.id }}</td>
          </ng-container>
          <ng-container matColumnDef="text">
            <th mat-header-cell *matHeaderCellDef mat-sort-header>Event</th>
            <td mat-cell *matCellDef="let row">{{ row.text }}</td>
          </ng-container>

          <tr mat-header-row *matHeaderRowDef="displayedColumn"></tr>
          <tr mat-row *matRowDef="let row; columns: displayedColumn"></tr>

          <tr *matNoDataRow>
            @if (filter) {
              <td class="mat-cell" colspan="4">No records with data '{{ filter }}'</td>
            }
          </tr>
        </table>
      </div>

      <mat-paginator
        #logDataPaginator
        [pageSizeOptions]="[10, 50, 100]"
        [showFirstLastButtons]="true"
        aria-label="Select page of log entries">
      </mat-paginator>
    </div>
  }
</div>
